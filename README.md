# DIP-Final-Cell-Segmentation
北京师范大学人工智能学院2025-2026学年度秋季学期《数字图像处理》课程大作业，基于分水岭算法的细胞图像分割及其改进。

## 项目简介

本项目的中文题目为**基于分水岭算法的细胞图像分割及其改进**，我们使用并改进分水岭算法，通过更好的前后景分割、注水点选择、图像选择、变值选择、形态学内容，对比Ostu算法、传统分水岭算法结果。最终在**Data Science Bowl 2018**数据集上，我们采用的**U-Net提取前景概率+自适应注水点选取+变值选取+形态学判断+梯度-概率加权图像+分水岭算法**方法达到0.1334的分割数量平均相对误差。本方法相比传统分水岭算法（过分割/欠分割问题严重）有明显改进。

## 项目结构

```text
.
├── LICENSE
├── README.md
├── Otsu.py                              # 基于Otsu的传统阈值分割代码
├── 传统分水岭.py                        # 传统分水岭代码
├── 传统分水岭+梯度.py                  # 使用梯度图像的传统分水岭代码
├── 改进分水岭.py                        # 改进的自适应分水岭代码
├── 改进分水岭+梯度.py                  # 改进的使用梯度图像的自适应分水岭代码
├── UNet分水岭.py                        # 改进的基于U-Net做前景标记的自适应分水岭代码
├── UNet分水岭+梯度.py                  # 改进的基于U-Net做前景标记的使用梯度图像的自适应分水岭代码
├── UNet分水岭+变换.py                  # 改进的基于U-Net做前景标记的使用变阈值的自适应分水岭代码
├── UNet分水岭+变换+梯度.py              # 改进的基于U-Net做前景标记的使用变阈值的使用梯度图像的自适应分水岭代码
├── UNet分水岭+变换+加权.py              # 改进的基于U-Net做前景标记的使用变阈值的使用梯度-概率加权图像的自适应分水岭代码
├── UNet分水岭+变换+加权+形态学.py        # 改进的基于U-Net做前景标记的加入形态学判断的使用变阈值的使用梯度-概率加权图像的自适应分水岭代码
├── 改进分水岭+变换+加权+形态学.py          # 改进的加入形态学判断的使用变阈值的使用梯度-概率加权图像的自适应分水岭代码
├── 改进分水岭+变换+形态学.py              # 改进的加入形态学判断的使用变阈值的自适应分水岭代码
├── 混合分水岭+变换+加权+形态学.py         # 改进的基于U-Net及二值化方法混合做前景标记的加入形态学判断的使用变阈值的使用梯度-概率加权图像的自适应分水岭代码
├── unet_nuclei.keras                   # 训练好的U-Net模型权重
├── 第六组数字图像处理PPT.pptx         # 课程结题报告幻灯片
└──数字图像处理论文                    # 论文Latex代码
```

## 数据准备

本项目使用 Data Science Bowl 2018 stage1_train，由于数据集过大等问题，本Git仓库未附带数据集。请前往Kaggle平台下载数据集并放置在按照结构将解压后的data-science-bowl-2018文件夹放在与本项目根目录同级的位置，结构应当如下。

```text
..
├── DIP-Final-Cell-Segmentation           # 本项目文件夹，假设文件夹命名如左。
├── data-science-bowl-2018              # 数据集直接解压后形成的文件夹
|   ├── stage1_train/
|   |   ├── <image_id>/
|   |   |    ├── images/<image_id>.png
|   |   |    └── masks/*.png
|   |   └── ...
|   └── ...
```

## 训练与运行说明

### 训练

所有 U-Net 相关代码已保留训练、验证逻辑，如需训练，请删除unet_nuclei.keras后正常运行代码即可。

### 运行

下以UNet分水岭+变换+加权+形态学.py为例给出运行代码。

```bash
python UNet分水岭+变换+加权+形态学.py
```

每个测试图像输出 两张结果图：

<image_id>_vis.png，可视化整体流程，包括原图、GT Mask（答案图）、对哪张图做分水岭、划分结果。

<image_id>_result.png，仅包括划分结果。

结果目录结构为：

```text
result_*/
├── <image_id1>_vis.png
├── <image_id1>_result.png
├── <image_id2>_vis.png
...
```

### 定量评价指标

本项目对测试集每张图像输出细胞数量预测与实际结果个数对比，以测试级平均相对误差作为指标。


### 依赖环境

建议使用以下环境：
```text
Python >= 3.9
TensorFlow  >= 2.9
numpy
opencv-python
scikit-image
scipy
matplotlib
tqdm
```

安装依赖：
```bash
pip install tensorflow numpy opencv-python scikit-image scipy matplotlib tqdm
```

## 贡献者与许可

本项目为北京师范大学人工智能学院2025-2026学年度秋季学期数字图像处理课程（李嘉老师）大作业，组号为第六组。本项目由AGRonin、evol-te、zyc286合作完成。

本项目基于MIT License开源。

特别的，对于学生而言，如果您将此代码直接用于课程作业，请遵守您所在院校的学术诚信政策，将此代码作为您自己的作品提交可能构成学术不端行为。

## 致谢

感谢所有为本项目付出时间、精力的同学、老师们。感谢看到这里的你～